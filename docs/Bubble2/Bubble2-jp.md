---
marp: true
theme: default
size: 16:9
header: ''

page_number: true
paginate: true
---

Programming Boot Camp Learning Phase #4

# Bubble Basic #2-1

2022/11/26

---

## 事前準備

- 本日は前回作成したペットの健康管理アプリに、デザインやロジックを追加していきます
- 本日の講義用に多少手を加えていますので、開始時点をそろえるため、こちら側で用意したアプリケーションを複製したものを利用してもらいます
- 複製したアプリケーションを配布しますので、`@Naotake KYOGOKU` 宛てに、Bubbleのアカウントを作成したメールアドレスを伝えてください。
![w:500px](images/2022-11-24-08-51-37.png)

---

## 今日やること

  - 前回のおさらい
  - デザインを作りこむ
  - ロジックを作りこむ

---

## 前回のおさらい

- [Bubble](https://bubble.io/) はビジュアルプログラミングツールとうたっており、画面からポチポチと操作して、見た目や動きをプログラミングできるツールです。
- Webアプリケーション前提であり、ディスプレイサイズにあわせた対応をいれスマホやPCに対応させます。

- 前回お休みの方はこちらの資料でキャッチアップしましょう
  - https://github.com/GuildWorks/titech-2022/tree/master/docs/Bubble1

---

## 前回のおさらい

ペット管理アプリケーションのペットの登録、一覧、詳細、体重記録の画面を
作りながら、Bubbleの基本である、Design/Workflow/Dataの使い方を学びました。

![w:800](images/2022-11-25-09-05-41.png)

---

## 今日やること

今回は前回までのアプリケーションに対して、デザインやロジックをさらに作り込んでいきます

---

### 最終的にはこんな感じになります

トップページ

![w:700](images/2022-11-26-02-50-05.png)![w:350](images/2022-11-26-02-50-24.png)

---

ペットリスト

![w:700](images/2022-11-26-02-51-38.png)![w:300](images/2022-11-26-02-51-20.png)

---

ペット詳細

![w:700](images/2022-11-26-02-52-36.png)![w:300](images/2022-11-26-02-52-54.png)

---

アドバイザー用ペットリスト

![w:900](images/2022-11-26-02-57-34.png)

---

### では、さっそくはじめていきましょう。
### まずはデザインを作りこんでいきます

---

### デザインの作り込みでやること

- ディスプレイサイズに合わせた画面をつくろう
  - レスポンシブウェブデザインという手法を使って、ディスプレイサイズに見た目を制御します
- Styleを使ってみよう
  - Styleを編集・追加したり、個別にスタイルをあてます

---

## ディスプレイサイズに合わせた画面をつくろう

---

## ディスプレイサイズに合わせた画面をつくろう

- WebアプリケーションはPCやタブレット、スマートフォンといった様々な端末で利用されます。
- 端末毎にディスプレイサイズが違うのですが、それらに対応する手法としてレスポンシブウェブデザインというデザイン手法があります
- 画面サイズに応じて、要素が伸びる／縮む、折り返す／折り返さない、表示する／表示しないといった見た目の切り替えが柔軟に行われる手法になります。
- 実現方法として、固定した配置やサイズを指定するのではなく、配置やサイズを決めるためのルールを指定します。
- Bubbleは初期設定では、固定の配置やサイズが指定されるようになっていますが、各種ルールを指定することもできるようになっています。

---

## よく使うルール

Bubbleでレスポンシブデザインを実現するために、よく使うルールとして以下のようなものがあります。

1. 親要素内の配置ルール
2. 要素のサイズ決定ルール
3. 表示の有無ルール

これらのルールを組み合わせて、レスポンシブな画面デザインを実現します。
なお、これらのルールはBubbleに限らず、Webアプリケーション全般に通じる考え方でもあります。

後ほど、一緒に画面に組み込んでいきますが、難しい考え方もあるので、まずは概要を説明していきます。

---

## ルール1：親要素内の配置ルール

親要素の中でどう配置するかという、ルール指定になります。

リピーティンググループなどのグループやページ全体など個々の要素を囲むような親要素をBubbleではContainerと呼ばれています。
Containerでは中に含む子要素の配置ルールを指定できます。

![w:600](images/2022-11-25-09-18-25.png)

---

子要素の配置ルールとしては以下の4つがあります。

- Fixed：配置場所を固定で指定する
- Aligng to parent：親要素に対する相対位置を指定する
- Row：行方向（水平方向）に並べる
- Column：列方向（垂直方向）に並べる

順に説明していきます。

---

## Fixed：配置場所を固定で指定する

配置場所を固定で指定するルールです。配置場所をピクセル単位で指定します。
Bubbleで親要素を置いた場合の初期設定となります。

固定で指定しているため、画面幅を変更しても指定した位置から変更されません。下の例では、画面の外にはみ出してしまっています。

![w:400](images/2022-11-25-07-40-30.png)→![w:120](images/2022-11-25-07-41-48.png)

---

## Aligng to parent：親要素に対する相対位置を指定する

親要素に対する相対位置を指定するルールです.
Bubbleでは、9つのエリアから配置場所を指定できる。
![](images/2022-11-25-07-46-27.png)

画面幅を変更したら、相対位置を維持して動く。下の例では、画面幅を狭めると、左上・中央・右下という相対位置を維持して動いている。
![w:500](images/2022-11-25-07-48-50.png)→![w:140](images/2022-11-25-07-50-08.png)

---

## Row：行方向（水平方向）に並べる

行方向（水平方向）に並べるルールになります。行は自動で折り返します。
下の例では、画面幅を狭めると、行が折り返していき、結果として縦に並んでいます。
![w:300](images/2022-11-25-07-56-45.png)→![w:140](images/2022-11-25-07-57-06.png)

---

## Row：行の中での水平方向（左右）の配置を指定できる
要素ごとに行の中での垂直方向の配置を指定できます。
![w:600](images/2022-11-25-08-14-01.png)
![w:300](images/2022-11-25-08-14-33.png)　(Left-aligned)
![w:300](images/2022-11-25-08-14-54.png)　(Centered)
![w:300](images/2022-11-25-08-15-15.png)　(Right-aligned)
![w:300](images/2022-11-25-08-16-46.png)　(Space-around)
![w:300](images/2022-11-25-08-17-11.png)　(Space-between)

---

## Row：行の中での垂直方向（上下）の配置を指定できる
行の中での垂直方向の配置を指定できる。
※これは親要素ではなく、子要素に対して指定するものになります。

![w:600](images/2022-11-25-08-10-28.png)
![w:300](images/2022-11-25-08-07-34.png)![w:300](images/2022-11-25-08-08-19.png)![w:300](images/2022-11-25-08-08-49.png)

---

## Column：列方向（垂直方向）に並べる

列方向（垂直方向）に並べる.
下の例は左右中央寄せで縦に並べており、画面幅を小さくしても中央寄せを維持したまま縦に並んでいる。
![w:450](images/2022-11-25-08-29-13.png)→![w:130](images/2022-11-25-08-29-31.png)

Rowと同様に水平、垂直の配置を指定できる。（水平・垂直で指定できる内容は反対）

---

## ルール1(おさらい)：親要素内の配置ルール

親要素の中でどう配置するかという、ルール指定になります。
子要素の配置ルールとしては以下の4つがあります。

- Fixed：配置場所を固定で指定する
- Aligng to parent：親要素に対する相対位置を指定する
- Row：行方向（水平方向）に並べる
- Column：列方向（垂直方向）に並べる

---

## ルール2：要素のサイズ決定ルール

画面幅によって、大きくなったり小さくなったりできるように、固定サイズを指定のではなく、サイズを決めるためのルールを指定します。主に以下の二つのいずれかを利用します。
- 親要素の大きさに対するパーセンテージを指定する
- 伸び縮みした場合の最大・最小サイズを指定する
  - ※最大最小は指定せずに、無制限にすることも可能

---

## パーセント指定

下の例は、画面に対して幅が80%になるように指定しています。画面幅を小さくすると、80%の割合を維持しながら画像サイズも小さくなります。

![w:600](images/2022-11-25-08-43-41.png)→![w:180](images/2022-11-25-08-44-19.png)

---

下の例は、幅を最大800px、最小300pxに指定しています。
300pxから800pxの間で伸縮しますが、画面を広げきっても800px以上は大きくならないですし、逆に画面を狭めても300px以下にはなりません。

![w:600](images/2022-11-25-08-49-25.png)→![w:150](images/2022-11-25-08-50-59.png)

---

## ルール3：表示の有無ルール

画面幅の下限や上限をしていして、画面内の要素の表示・非表示を切り替えることができます。

下の例は、画面幅が800px以下になった場合に画像を表示しないという指定をしています。
![w:600](images/2022-11-25-09-02-33.png)→![w:170](images/2022-11-25-09-03-22.png)

画面が大きい場合だけ情報を多く表示したいと言った場合によく使います。

---

## よく使うルール(おさらい)

Bubbleでレスポンシブデザインを実現するために、よく使うルールとして以下のようなものがあります。

1. 親要素内の配置ルール
2. 要素のサイズ決定ルール
3. 表示の有無ルール

では、実際に使ってみましょう。

---

## （再確認）事前準備

- 本日は前回作成したペットの健康管理アプリに、デザインやロジックを追加していきます
- 本日の講義用に多少手を加えていますので、開始時点をそろえるため、こちら側で用意したアプリケーションを複製したものを利用してもらいます。
- 複製したアプリケーションを配布しますので、`@Naotake KYOGOKU` 宛てに、Bubbleのアカウントを作成したメールアドレスを伝えてください。

![w:500px](images/2021-11-17-05-35-39.png)

---

## トップページ（ログインページ）にレスポンシブデザインを適用します
まずは、トップページ（ログインページ）にレスポンシブデザインを適用します。
対応前は、スマホで表示するとログインエリアが隅の方に見えているだけです。
対応すると、画面幅に応じて中央に表示されるようになります。
![w:200](images/2022-11-25-09-54-55.png)→![w:210](images/2022-11-25-10-22-24.png)

親要素内の配置ルールとして紹介した、Aligng to parentを使います。

---

トップページ(ログインページ）を開いてください。手順は覚えていますか。
- 画面左のメニューの `Design` を開く。
- 画面左上のbロゴの右をクリックして、indexページを選ぶ。
![bg right w:600](images/2022-11-25-09-52-58.png)

---

画面の空白部分をダブルクリックして、ページ自体の設定ウィンドウを開いてください。

![](images/2022-11-25-10-03-17.png)

---

- `index`というタイトルの設定ウィンドウが開いたはずです。
- `Layout`というタブを開いてください
  - 開いた初期状態だと`Container layout`に`Fixed`と設定されています。
  - これが固定配置のルールになっているという状態です。
  - こちらを変更していきます。

![bg right w:600](images/2022-11-25-10-04-19.png)

---

`Container layout`に`Fixed`から`Align to parent`に変更してください
- これで親要素（ここではindexページ自体）では、子要素は相対的な配置指定をするというルールが指定されました。
![bg right w:600](images/2022-11-25-10-09-32.png)

---

続いて、`Login Form`の設定ウィンドウを開いてください。
- ログインフォームの外枠のあたりをクリック
  - マウスをもっていくと、枠がいくつか出ますが、一番外枠のものになります。
- ウィンドウのタイトルが `Login Form`となっていることを確認してください。要素が入れ子になっているため、他の要素の設定ウィンドウを開いてしまっていないか要注意です。

![bg right w:600](images/2022-11-25-10-14-39.png)

---

中央に配置します。
-  `Login Form`の設定ウィンドウの`Layout`タブを開き
- 配置位置が並んでいる箇所で中央を選択する。
![bg right w:400](images/2022-11-25-10-20-11.png)

---

指定できたらプレビューで確認してみましょう。
ブラウザの幅を小さくしても、画面中央に配置されるようになっているはずです。

これで、親要素内の配置ルールとして紹介した、Aligng to parentの使い方がわかりましたね。

![bg right w:300](images/2022-11-25-10-21-37.png)

---

## ペット一覧ページにレスポンシブデザインを適用します
次は、ペット一覧ページにレスポンシブデザインを適用します。
対応すると、画面幅に列数が柔軟に変わり、すべてのペットが一覧で見れます。
![w:210](images/2022-11-25-12-57-34.png)→![w:190](images/2022-11-25-19-43-10.png)

親要素内の配置ルールとして紹介した、Columnを使います。
またサイズの指定やリピーティンググループ特有のレスポンシブ対応用の設定も組み合わせていきます。

---

ログインページと同じ要領で、ページの`Container layout`を変更しましょう。
今回は、`Column`を指定します。
- `pet_list`の画面を開く
- ページの空白部分をダブルクリックして、ページ自体の設定ウィンドウを開く
- 設定ウィンドウのLayoutタブを指定する
- `Container layout`を`Column`に変更する

![bg right w:400](images/2022-11-25-13-04-53.png)

---

そうすると、勝手に画面内の要素が縦に並ぶようになりましたね。
`Column`で設定された親要素の直下の子要素は列方向（垂直方向）に勝手に整列されるのです。この並びを基本として、整えていきます。
![w:500](images/2022-11-25-13-07-22.png)

---

続いて、リピーティンググループに対して設定をいれていきます。
- リピーティンググループ`pet list`の設定ウィンドウを開き、`Layout`タブに移動する
- 以下の設定をいれる
  - Horizontal alignment:`centered`

![w:600](images/2022-11-25-13-19-40.png)

ペット一覧ページ直下の要素が列方向に並ぶようにしていますが、その際にこのリピーティンググループは左右中央寄せに整列されるようになります。

---

さらに、以下の設定をいれる
  - Make this element fixed-widtht: チェックなし
  - Min widht: 指定なし
  - Max width: 1010px

このリピーティンググループの幅は固定にせず、親要素（ここでは画面自体）の幅に応じて柔軟に伸縮します。ただし、広がりすぎると見えにくくなるので、最大幅は1010pxまでとしています。

![bg right w:400](images/2022-11-25-13-48-42.png)

---

以下の設定をいれる
  - Make this element fixed-height: チェックなし
  - Min height: 指定なし
  - Max height: 指定なし(inf)　※おそらくinfinityの略
  - Fit height to content: チェック

このリピーティンググループの高さは固定せず、中身に合わせてどこまでも伸縮するという設定です。

![bg right w:400](images/2022-11-25-13-25-28.png)

---

ここまでで、プレビューを表示してみましょう。

まだ不細工ですが、リピーティンググループが中央に寄っており、縦横が伸縮するようになっているはずです。

![w:600](images/2022-11-25-13-30-34.png)![w:150](images/2022-11-25-13-31-02.png)

でも、セルの大きさが意図した大きさになっていなかったり、列数も変わらないですね。その設定をしていきましょう。

---

次はリピーティンググループの設定ウィンドウの`Appearance`タブに移ってください。
以下を設定していきます。
- Set fixed number of rows: チェックなし
- Min height of row: 200px
- Set fixed number of columns: チェックなし
- Min widht of column: 250px

列数と行数は固定せず、行と列の最低幅を指定するようにしています。これによって、行数や列数が最低幅を維持しながら、表の大きさによって柔軟に切り替えられます。

---

では、プレビューを表示してみましょう。

まだ不細工ですが、画面の幅・表の幅に合わせて、列数・行数が変動するようになりました。

![w:600](images/2022-11-25-18-40-10.png)![w:150](images/2022-11-25-18-41-08.png)

でも、セルの中で左によってしまっていたり、幅を小さくしていく際に意図しない余白ができてしまっていたりしますね。修正していきましょう。

---


またリピーティンググループの設定ウィンドウの`Layout`タブに移ってください。
以下を設定します。
- Cell's container layout: Align to parent

ログインページで使った設定ですね。親要素（ここではリピーティンググループの一つ一つのセル）に対して、相対位置で要素を配置できるようになります。

![bg right w:400](images/2022-11-25-18-46-01.png)

---

次にセルの中身の要素のレイアウトをしていきます。

要素が重なっていて選びにくいので、画面左の`Elements tree`から指定します。
- Designメニューの`UI Builder`の最上部に`Elements tree`という部分があります。
- `Only show hideable`のチェックがついていたら外してください。
- ※`pet list`しか表示されていない場合は、`+`をクリックしてツリーを開いてください。

![bg right w:400](images/2022-11-25-18-51-06.png)

---

では、`pet list image`から順に設定していきます。
- `Elements tree`の`pet list image`をクリックして設定ウィンドウを開く
- `Layout`タブ内で右の画像と同様に設定してください。

セル内の真ん中に配置し、縦横比を4:5に保ったままセル内いっぱいまで大きく表示する、という設定になります。

![bg right w:400](images/2022-11-25-19-00-50.png)

---

次は、`Shape A`の`Layout`に右の画像と同様の設定をいれます。

セル内の下部に配置し、高さ45pxを保ったまま左右いっぱいまで大きく表示する、という設定になります。

![bg right w:400](images/2022-11-25-19-05-28.png)

---

次は、`pet list name`の`Layout`に右の画像と同様の設定をいれます。

`Shape A`と同じ内容ですね。

![bg right w:400](images/2022-11-25-19-08-56.png)

---

プレビューします。

惜しいですね。あとはヘッダーの位置や余白が気になります。

![w:800](images/2022-11-25-19-09-40.png)![w:200](images/2022-11-25-19-10-45.png)

---

ヘッダーの設定ウィンドウを開き、`Layout`に右の設定を入れます。

ページ内で列方向に並べられる際に、中央揃えで表示する。横幅は固定せずページ幅に応じて、最大1080pxまで伸びる。下側に20pxの余白をとる。という設定です。

![bg right w:350](images/2022-11-25-19-29-48.png)

---

## MaginとPaddingについて

Marginという言葉がはじめて出てきましたので、説明します。
余白を表す言葉に、MarginとPaddingというものがあり、それぞれ以下を意味します。
- Margin：要素の境界の外側の余白
- Padding：要素の境界の内側の余白

![](images/2022-11-25-19-32-28.png)

境界線の内と外ととで、余白を使い分けたい時に意識してみてください。

---

ついでに、リピーティンググループにも余白をいれておきます。

リピーティンググループの`Layout`タブで以下を設定してください。

上下の余白に10px、左右の余白に50pxをとるという設定になります。

![bg right w:300](images/2022-11-25-19-38-36.png)

---

では、プレビューしましょう。

![w:800](images/2022-11-25-19-40-18.png)![w:250](images/2022-11-25-19-40-38.png)

やったー。
なお、ハンバーガーメニューが出てますが動作しないのは気にしないでください。

---

### <Adavanced>

## ペット詳細画面にレスポンシブデザインを適用しよう

ペット詳細画面がせっかくのPC画面の広さを活かせないようになっているので、レスポンシブ対応しましょう。

親要素内の配置ルールのRowを利用して、多段組の設定をします。
また要素の表示、非表示の制御も行います。

![w:400](images/2022-11-25-19-46-25.png)→![w:500](images/2022-11-25-23-12-02.png)

---

グループを組み合わせて、こんな段組みをつくります。
![w:800](images/2022-11-25-23-18-25.png)

---

こんな感じになります。

![w:700](images/2022-11-25-23-12-02.png)![w:300](images/2022-11-25-23-12-15.png)

---



まずは、このようなグループをつくっていきます。

![bg right w:450](images/2022-11-25-21-38-49.png)

---

画像エリアとテキストエリアに分けたいので、それぞれのグループを作成します。

- 画像のラベルと画像表示部分をドラッグして選択する
- 右クリック（もしくは、ダブルタップ）してメニューを出す
- `Group elements in a Fixed container`を指定する。

選択した要素が含まれるグループが作成されます。固定配置（Fixed）のグループとして作成しているので、グループ内では固定の配置になります。

![bg right w:700](images/2022-11-25-19-53-13.png)

---

同様に、名前、誕生日、性別の要素をドラッグして、Fixedのグループを作成します。

![bg right w:500](images/2022-11-25-19-59-14.png)

---

作成したグループは、あとでわかりやすいように名前をつけておきましょう。
- `Elements tree`からグループをクリックし、設定ウィンドウを出す
- 設定ウィンドウのタイトル部分をクリックすると、名称を変更する
  - `Group A` → `Image Group`
  - `Group B` → `Text Group`

![bg right w:700](images/2022-11-25-20-00-45.png)

---

また、グループと要素がピッタリ重なっていたら、あとでグループを選択したいとなった時に選択しづらいので、少しグループを大きく広げておきましょう。
- `Elements tree`からグループをクリックし、設定ウィンドウを出す
- Groupの要素の端の四角をドラッグして広げる

![bg right w:500](images/2022-11-25-20-12-33.png)

---

続いて、画像エリアとテキストエリアが横に並ぶような段組みを作りたいので、`Image Group`と`Text Group`を選択して、さらにグループを作ります。
- `Image Group`を選択（少し大きくしておいたので選択しやすいですね）
- `Text Group`もShiftを押しながら選択（二つのグループが選択状態になる）
- 右クリック（もしくは、ダブルタップ）してメニューを出す
- `Group elements in a Row container`を指定する。
![bg right w:500](images/2022-11-25-20-25-56.png)

---

後でグループを選択しやすいように、また少し広げておきましょう。

グループに対して`Row`で指定することで、子要素を行方向（水平方向）に並べるグループになっています。
行は自動で折り返すようになっており、ここで作成した状態では、グループの幅が小さいので折り返されている状態になります。試しに幅を十分に広げると、行方向に並びます。

![bg right w:500](images/2022-11-25-20-27-32.png)

---

`Weight Logs`リンクと`Back to list`リンクも横に並ぶような段組みを作りたいので、グループを作ります。
- `Weight Logs`リンクを選択
- `Back to list`リンクをShiftを押しながら選択
- 右クリック（もしくは、ダブルタップ）してメニューを出す
- `Group elements in a Row container`を指定する。
- また少し広げておきましょう

![bg right w:300](images/2022-11-25-21-32-34.png)

---

作成したグループは、あとでわかりやすいように名前をつけておきましょう。
- `Elements tree`からグループをクリックし、設定ウィンドウを出す
- 設定ウィンドウのタイトル部分をクリックすると、名称を変更する
  - `Group C` → `Contents Group`
  - `Group D` → `Navigation Group`
![bg right w:700](images/2022-11-25-21-34-24.png)

---

グループをたくさんつくりましたが、うまく作れていれば、右のような状態になっているはずです。

![bg right w:450](images/2022-11-25-21-38-49.png)

---

`pet_detail`ページ自体を`Column`に指定します。
- 画面の空いている部分をクリックして、`pet_detail`を選択する
- `Layout`タブを開く
- `Container layout`に`Column`を指定

![bg right w:450](images/2022-11-25-21-43-42.png)

---

そうすると、要素が左側によって、縦一列に並んでいるはずです。

`Column`で指定されたことにより、列方向に整列させられている状態ですね。

![bg right w:400](images/2022-11-25-21-46-34.png)

---

ヘッダー（`header A`）を選択して、Layoutを右のように指定します。

設定内容の意味は、理解できていますね。
- 列方向に整列する際には、親要素に対して中央揃えにする
- 幅は親要素に合わせて、最大1100pxまで伸び縮みする。
- 下側に20pxの余白をとる。
![bg right w:350](images/2022-11-25-21-51-47.png)

---

`Contents Area`を選択して、Layoutを右のように指定します。

新しい設定が出てきましたね。以下の意味になります。
- 行方向に整列させる際には、子要素（ここでは、`Image Area`と`Text Area`）は真ん中に寄せる。
- 子要素を整列させるときに、要素間の間の行間隔と列間隔は40pxあける。
- 親要素に対して、列方向に整列させる際には中央に寄せる。
- 親要素に合わせて横幅は伸縮する。
![bg right w:350](images/2022-11-25-22-10-58.png)

---

余白も指定しておきましょう。

![bg right w:350](images/2022-11-25-22-24-15.png)

---

次に`Navigation Area`を選択して、Layoutを右のように指定します。

以下の意味になります。
- 行方向に整列させる際には、子要素は左右に広げる。
- 親要素に対して、列方向に整列させる際には中央に寄せる。
- 横幅は親要素に合わせて伸縮する。
- 縦幅はコンテンツに合わせて伸縮する。

![bg right w:350](images/2022-11-25-22-49-27.png)

---

`Back to list`リンクと`Weight Logs`リンクの位置を並べ替えましょう。

- `Back to list`リンクを選択して設定ウィンドウを開く
- `Layout`タブを開く
- `Previous`ボタンを押す

このように、`Row`や`Column`で指定された親要素内での整列順序を変更することができます。ドラッグでも変更できますが、グループの外にだしてしまったりするので、こちらの方が指定しやすいです。

![bg right w:350](images/2022-11-25-22-28-41.png)

---

同様に`Contents Group`と`Navigation Group`の位置を並べ替えましょう。

- `Navigation Group`リンクを選択して設定ウィンドウを開く
- `Layout`タブを開く
- `Previous`ボタンを押す

![bg right w:350](images/2022-11-25-22-33-34.png)

---

プレビューしましょう。
細かなところが多少気になりますが、段組みのレイアウトができました。
スマホだと縦に並びますね。

![w:800](images/2022-11-25-22-38-11.png)![w:200](images/2022-11-25-22-38-57.png)

---

### <Excercexercises>

レイアウトの微妙な部分が気になる方は以下のようなことをやってみてください。
- `Back to list`リンクと`Weight Logs`リンクの横幅をコンテンツに合わせて伸縮するようにする。
- `Navigation Area`の左右に余白をとる。
- 画像サイズを広げたり、テキストの整列を整える

---

こんな感じになります。

![w:750](images/2022-11-25-22-52-12.png)![w:300](images/2022-11-25-22-52-27.png)

---

## 次に体重のグラフをもってきます

- pet_weight_registerの画面で、グラフをクリックしてコピーする
- pet_detailの画面に貼り付ける
- `Layout`で`Next`を押して行って、一番下に配置する
- さらに`Layout`の他の項目を右の図のように指定する

![bg right w:350](images/2022-11-25-22-59-16.png)

---

スマホで1画面にグラフまで出すと窮屈なので、画面幅が小さいときには表示させないようにします。

- グラフの設定ウィンドウを開いて、`Conditional`タブを開きます
- 条件を新しく作成して、`When`に`Current page width`、`<`、`800`を指定します。いまの画面サイズが800より小さければという意味ですね.
- その場合の変更内容を定義します。`This element is visible`を選択して、チェックなしの状態のままにしましょう

![bg right w:500](images/2022-11-25-23-07-53.png)

---

プレビューしましょう。

![w:700](images/2022-11-25-23-12-02.png)![w:300](images/2022-11-25-23-12-15.png)

スマホ表示では、グラフが表示されないですね。

---

## よく使うルール(おさらい)

Bubbleでレスポンシブデザインを実現するために、よく使うルールとして以下のようなものがあります。

1. 親要素内の配置ルール
2. 要素のサイズ決定ルール
3. 表示の有無ルール

これらを組み合わせて、レスポンシブデザインを適用しました。

---

## Styleを使ってみよう

---

## Styleを使ってみよう

- これまではBubbleが標準で用意してくれていたスタイルを利用してきました
- 実際のプロダクトでは、プロダクトにあったデザインコンセプトを描き適用していきます
- ここからスタイルを変更する方法を説明します

---

## Styleの適用方法には大きく3つあります

- 既存のスタイルを編集する
- 個別でスタイルを適用する
- 新しいスタイルを追加する

順にやっていきましょう

---

# 既存のスタイルを編集する

既存のスタイルを変更して、ボタンやリンクの色を変更したいと思います。

![w:800](images/2022-11-26-00-31-44.png)

---

## Style variablesをつかってみよう

Bubbleでは、基本となる色やフォントが`Style variables`として設定されています。

左メニューの`Styles` > 画面上部のタブで`Style varilables`に移動してみてください。ここで指定された色は、スタイルの作成時や編集時に利用することができます。例えば、Primaryという色設定は、Primaryボタンで利用されています。

![w:800](images/2022-11-26-00-23-44.png)

---

`Style variables`の`Primary`の設定を変更すると利用されているすべての箇所に変更が適用されています。
- 左メニューの`Styles` > 画面上部のタブで`Style varilables`と選択
- Primaryを変更する。（私は暗い目の赤にしたいので、`#D62755`で指定します。）

![w:600](images/2022-11-26-00-15-38.png)

---

Primaryボタンのスタイルを確認すると、変更されていますね。

![w:800](images/2022-11-26-00-26-56.png)

---

画面をプレビューしてみましょう。
ログイン／ログアウトボタンなど、基調となっていたボタンやリンクの色が変っています。

![w:800](images/2022-11-26-00-28-14.png)

---

## Style variablesの使いどころ

このように、`Style variables`を編集することで、標準の基調カラーを一括で変更できます。また、新たにスタイルを作成・編集する際も自分でルールを決めて`Style variables`を利用しておくことで、あとから一括で変更するなどメンテナンスが楽になります。

---

## 次に、個別でスタイルを指定してみましょう

ヘッダーロゴを基調色にあわせつつ、フォントももう少しかわいらしい感じにしたいと思います。

![w:900](images/2021-11-20-02-10-35.png)

---

bロゴ右のメニューを開いて、Headerを選びます

![](images/2021-11-20-01-57-35.png)


---

- ロゴをダブルクリックして、設定を開く
- 設定ウィンドウの`Style`の部分に移動する
- プルダウンの右下あたりの`Remove style`をクリック
  - 定義されたStyleを適用するのではなく、個別で指定できるようになります

![bg right w:500](images/2022-11-26-00-34-55.png)

---

好きなスタイルを指定しましょう
- 私はフォントカラーは、`Style variables`で指定したPrimaryカラー
- フォントは`Noto Serif Dogra`が気に入ったので、それを指定します
- フォントを変えると、ロゴが見切れたりすることがあるので、幅は適宜調整してください

![bg right w:500](images/2022-11-26-00-38-28.png)

---
## プレビューしましょう

変わりましたね。

![w:800](images/2022-11-26-00-39-03.png)


---

## 次は、新しいスタイルを追加してみましょう

ラベルが大きすぎて気になるので、ラベル用のスタイルを作っちゃおうと思います。

![w:800](images/2022-11-26-00-46-25.png)

---

まずは個別にスタイルを指定します。

- pet_detailを開いて、`Image`テキストをダブルクリックして、設定を開く
- `Style`のプルダウン右下の`Remove style`をクリック

![bg right w:600](images/2021-11-20-02-16-53.png)

---

以下の設定にします
- フォントは`Barlow`
- フォントウェイトは`600`
- フォントサイズは`12`
- `Center the text vertically`にチェック

![bg right w:400](images/2022-11-26-00-42-07.png)

---

続いて、指定した個別のスタイルを共通のスタイルとして定義します

- そのまま`Image`の設定の中で、`Style`のプルダウンを開く
- 一番下の`Create a new style..`をクリック

![bg right w:400](images/2021-11-20-02-23-00.png)

---

- Style名に`Label`と入れる
- Element styleは`Text`のまま、テキストElementのスタイルであることを示しておく
- Use style ofは`Text Image`のまま、`Text Image`を元としてスタイルをつくります

![bg right w:400](images/2021-11-20-01-49-05.png)

---

スタイルにLabelが指定されるようになっているはずです。

![](images/2021-11-20-02-24-36.png)


個別に指定したスタイルを共通のスタイルとして定義するのではなく、
先にスタイルを定義する方法もありますが、個別でスタイルを
指定したものを共通のスタイルとして設定する方が
デザインビューでイメージを確認しながらつくれるのでやりやすいです。

---

では、定義したスタイルを他のラベルにも適用していきましょう。

- pet_detail: Name, Birthday, Gender
- pet_register: Image, Name, Birthday, Gender
- pet_weight_register: Weight

ちょっと多くて手間ですね。

最初からスタイルを分けていたら、一カ所のスタイルを変更するだけで済んだので、意味合いが異なる画面要素がでてきたら、スタイル定義しておくということを意識しておくとよいでしょう。

----

## プレビューしましょう

![w:800](images/2022-11-26-00-47-20.png)

Styleについては以上です。

---

## ロジックを作りこむ

---

## ロジックを作りこむ

アプリケーションには様々なところにロジックが埋め込まれています。

- 画面操作に対するフィードバックを返す
- データを抽出、加工する
- 画面を権限によって切り替える　など様々です

Bubbleでも様々なところにロジックを埋め込めるので一緒にやっていきましょう。

---

## 画面操作に対するフィードバックを返す

---

## 画面操作に対するフィードバックを返す

Bubbleでは画面要素に対してロジックを埋め込めます。
画面操作に対するフィードバックを作り混むのに使えます。

ペットリストにホバーしたら、赤枠が付くような動きをつけてみましょう

![w:800](images/2022-11-26-00-53-48.png)

---

画像Elementにロジックを埋め込んでいきます
- pet_listを開く
- ペット画像の画像Elementをダブルクリックして、設定を開く
- タブから`Conditional`を指定する
- `Define another condition`ボタンをクリックする

レスポンシブの表示有無のルール指定でもふれましたが、ここで条件と条件に合致した場合にプロパティをどう変更するかを定義できます。

![bg right w:600](images/2021-11-20-02-53-06.png)

---

まずは何に関する条件が指定できるか見てみましょう。

- 該当の画像Elementやその親要素や画面内の他の要素
- ログインユーザー
- 新規でのデータ検索
- 現在、日付や現在位置、ページ幅、スクロール位置など現在の状態

という具合に、なんかいろいろな条件が指定できそうなのがわかると思います。

![bg right w:400](images/2021-11-20-02-55-53.png)

---

今回は単純に該当の画像`This Image`を選択しましょう.

すると、次は画像の状態がならびます。ここもいろいろありますが、今回は`is hovered`を選択してください。

これで、該当の画像がホバーされたらという条件になります。

![w:400](images/2021-11-20-03-05-21.png)

---

次に条件に合致した場合に、どのプロパティをどう変更するかという指定をします。
`Select a property to change when true`をクリックして、中を眺めてみましょう。

- 画像のソース、alt属性
- クリックできるか、ボーダーなど

いろいろ変更出来そうだというのがわかります。
ここに並ぶものはElementの種類によって異なります。

![bg right w:400](images/2021-11-20-03-09-36.png)

---

今回はホバーされたら、赤の枠線が付くようにします
- `Border style - all borders`をクリックする
- `None`となっている箇所を`Solid`に変更する
- 枠線が`なし`と指定されているのを`実線を表示`に変更しているという意味になります。

![bg right w:400](images/2021-11-20-03-16-54.png)

---

- `Select a property to change when true`を選ぶ
- `Border coloer - all borders`をクリックする
- 色を指定できるようになるので、定義してあるPrimaryを選ぶ
- 同様にして次は、`Border width - all boarders`を指定し、`2`を設定する

![bg right w:400](images/2022-11-26-00-53-18.png)

以上で設定完了です。

---

## プレビューしましょう

ホバーしたら、赤枠がでるようになりました。

![w:700](images/2022-11-26-00-53-48.png)

こうやって、ユーザー操作に対してわかりやすいフィードバックを返したり、画面の装飾を状態によって切り替えたりといったロジックを埋め込んで、プロダクトを作りこんでいくことができます。

---

## データを抽出、加工する

---

## データを抽出、加工する

特定のデータだけを抽出したり、取得したデータを加工や計算して出したりすることができます。
ペットのイニシャル、年齢、最新の体重を表示するようにします。

![bg right w:600](images/2022-11-26-01-27-11.png)

---

## 事前準備

これから要素を追加していくので、Name、Birthday、Genderの幅を縮めておきましょう。
- pet_detailで、Nameをダブルクリックして設定を開く
- Shiftを押しながら、NameのラベルからGenderのテキスト要素までを選ぶ
- 画面したの`Width`と表示されている部分をクリックする
- W(幅)に`110`を指定する
- `Apply changes to elements`ボタンを押す

![bg right w:400](images/2022-11-26-01-01-14.png)

---

## まずはイニシャルを表示します

- Nameのラベルの中身を、イニシャルを含むというのがわかるように`Name (Initial)`に変更する
![](images/2021-11-20-03-41-21.png)

---

- Nameの内容を出しているテキストを選択する
- テキスト入力欄の文字がない部分をクリックして、フォーカスをあてる
- ` (`と入力する
- `Insert dynamic data`を選択する
- `Current Page Pets`>`'s Name`を選択する
- `More...`と薄く出ているはずなので、クリックする

ここで様々な加工方法が選択できます。眺めて見ましょう。

![bg right w:400](images/2021-11-20-03-47-44.png)

---

- `truncated to`を選択する
  - これは指定された文字数までを切り取るという意味になります
- `1`と入力して、Enterキーで確定する
- また`More`と出るのでクリック
- `:uppercase`を選択する
  - これは大文字に変換するという意味なります
  - （日本語名をつけている方にとっては意味がないですが）
- テキスト入力欄の文字がない部分をクリックして、`)`を入力する

![](images/2021-11-20-03-52-12.png)

---

## プレビューしましょう

![w:700](images/2022-11-26-01-04-56.png)

---

## 最新の体重を表示します

- Birthdayのラベルとテキストをコピー＆ペーストして配置しましょう
- ラベルを`Latest Weight`に変更しましょう

![bg right w:600](images/2022-11-26-01-06-30.png)

---

- Latest Wightの中身を出すテキストの設定を開いて、テキスト入力エリアを空にします
- フォーカスをあてて、`insert dynamic data`をクリックします
- `Do a search for`をクリックします
  - データを検索するという意味ですね

![bg right w:600](images/2021-11-20-04-00-08.png)

---

現在ページで表示しているペットの体重を取得するという指定をします

- `Type`に`PetWeightLogs`を指定する
- `Add a new constraint`ボタンをクリックする
- 条件入力欄が現れるのでクリックして、`Pet`、`=`、`Current Page Pets`の順に指定する

様々な条件で取得ができるので、どんな条件があるのか眺めておきましょう

![bg right w:600](images/2022-11-26-01-08-01.png)

---

作成日の降順、すなわち新しく作られたもの順に並べるという指定をします

- `Sort by`に`Created Date`を指定する
- `Descending`に`yes`を指定する
- Closeする

並び順の指定は忘れがちですが、重要なことが多いです。

![bg right w:400](images/2021-11-20-04-06-52.png)

---

最新の1件の体重を表示します
- テキスト入力欄の`More`をクリックして、中身を眺めましょう
- 最初の1件目を取得したいので、`:first item`を指定する
- 続いて、`'s WeightKg`を指定する
- 空白部分をクリックして、`kg`と入力する

以上で、最新の体重の設定は完了です。
データ抽出、リスト加工の方法として覚えて起きましょう。

![bg right w:600](images/2021-11-20-04-10-59.png)

---

## プレビューしましょう。

![w:600](images/2022-11-26-01-09-47.png)

---
#### ＜Advanced＞

## ちょっと横道にそれて、
## 数値のMore、日付のMoreを眺めてみましょう。

Bubbleでは数値や日付についても、様々な加工・計算方法が提供されています。

---

#### ＜Advanced＞

## 年齢を計算する

次は年齢を出します。先ほど見たとおり、数値や日付の加工・計算はできるのですが、ちょっと年齢計算は難しそうなので、直接コードを埋め込んで実現しようと思います。

Bubbleではpluginを導入することで、javascriptというプログラミング言語を使った簡易的な処理を動作させることができます。

---

#### ＜Advanced＞

javascriptのコードを埋め込むためには、`Toolbox`というプラグインを利用します。
インストールしましょう。

- 左メニューの中の`Plugins`を指定
- 検索用のテキストボックスに`tool`と入力（検索には少し時間がかかる）
- 検索結果の一番上にでてくる`Toolbox`の`Install`ボタンを押す

![bg right w:600](images/2021-11-20-04-25-21.png)

---

#### ＜Advanced＞

Toolboxでのコードの埋め込み方は大きく2つあります、今回は以下の2通りを紹介します

- Workflow上の`Run javascript`で実行／Desing上の`Javascript to Bubble`で受取
  - 複数行にわたるような複雑な処理に使う
- Design上の`Expression`で実行兼受け取り
  - 単発で終わるような処理に使う

--- 

#### ＜Advanced＞

では、年齢を計算します。
`Run javascript`／`Javascript to Bubble`で行います。まずは、pet_detail画面に、`Javascript to Bubble`を仕込んでおきます。

- 左メニューの`Visual elements`から`javascript to Bubble`を選択する
- 画面の最下部など邪魔にならない場所におく
- javascriptの結果を受け取るためのものなので、プレビューなど実行時には表示されません

![bg right w:400](images/2021-11-20-04-45-28.png)

---

#### ＜Advanced＞

- `bubble_fn_suffix`に`age`と指定する
- `Publish value`にチェックする
- `Value type`に`number`と指定する

以上で、`bubble_fn_age`という関数（処理のかたまり）にjavascriptから値を渡すと、この画面要素で受け取れるようになります。

![bg right w:300](images/2021-11-20-05-17-45.png)

---

#### ＜Advanced＞

次にjavascriptを実行する箇所を定義します。
- 左メニューからWorkflowを選択する
- 正方形がならんでいるが、その一番右の`Click here to an event...`を選択する
- `General`>`Page is loaded`を選択する

![bg right w:700](images/2021-11-20-04-52-26.png)

---

#### ＜Advanced＞

- `Click here to add an action...`をクリックする
- `Plugins` > `Run javascript`をクリックする
- 設定が開くので、`Script`の欄に次のページのコードを貼り付ける

![bg right w:300](images/2021-11-20-05-00-40.png)

---

#### ＜Advanced＞

```
//生年月日
const birthday = {
    year: ,
    month: ,
    date: 
  };

function getAge(birthday){

    //今日
    let today = new Date();
 
    //今年の誕生日
    let thisYearsBirthday = new Date(today.getFullYear(), birthday.month-1, birthday.date);
 
    //年齢
    let age = today.getFullYear() - birthday.year;

    if(today < thisYearsBirthday){
        //今年まだ誕生日が来ていない
        age--;
    }

    return age;
}

bubble_fn_age(getAge(birthday));
```

---

#### ＜Advanced＞

3行目から5行目の、`year: `、`month: `、`date: `の後ろに`insert dynamic data`で年月日を差し込む
- `year: `の後ろ（`,`の前）にカーソルを置く
  - `insert dynamic data`>`Current Page Pets`>`'s Birthday`
  - `More`>`formatted as 11/20/21`
  - `Format type`に`Custom`を指定する
  - `Custom format`に`yyyy`を指定する
- 同様に`month: `の後ろにも、`Custom format`を`m`にして差し込む
- 同様に`date: `の後ろにも、`Custom format`を`d`にして差し込む

※入力後イメージは次のページ

---

#### ＜Advanced＞

入力後のイメージ
![w:800](images/2021-11-20-05-20-55.png)

---

#### ＜Advanced＞

表示するための画面要素を配置しましょう
- Birthdayのラベルとテキストをコピー＆ペースト
- ラベルをAgeに変更
- テキストの中身を`JavascripttoBubble A`>`'s value`と指定する

---

#### ＜Advanced＞

## プレビューしてみましょう

![w:600](images/2022-11-26-01-20-14.png)

---

#### ＜Advanced＞

次に犬猫年齢に換算したら何歳かも表示しようと思います.
`Expression`を用います。

- Visual elementsから`Expression`を選択して、先ほどの`Javascript to Bubble`の横辺りに配置する
- Expressionに`24 + (`と入力する
- `insert dynamic data`で`JavascripttoBubble A`>`'s value`を差し込む
- 続きに` -2) * 4`と入力する
- Result typeに`number`と指定する

![bg right w:500](images/2021-11-20-05-30-14.png)

---

#### ＜Advanced＞

表示の設定をします。
- Ageのラベルを犬猫年齢も含むことがわかりやすいように、`Age(as Dog/Cat)`と変更する
- Ageのテキストの中身に元々入力されているものの後ろに` (`と入力する
- `insert dynamic data`で`Expression A`>`'s value`を差し込む
- `)`と入力する

![bg right w:500](images/2021-11-20-05-34-15.png)

---

#### ＜Advanced＞
## プレビューしてみましょう
![w:500](images/2022-11-26-01-25-08.png)

---

## 画面を権限によって切り替える

---

## 画面を権限によって切り替える

ここまで、画面操作へのフィードバックやデータの抽出・加工など部分部分でのロジックの組み込みを説明してきました。

次は、複数機能にまたがるようなロジックをいれていこうと思います。

以下のことを行います。
- ユーザーをペットの飼い主（Pet Owner）とペットの飼育アドバイザー（Pet Advisor）に分ける
- 飼い主は今まで作ってきた画面・機能を利用できる
- アドバイザーはアドバイザー専用の画面・機能を利用できる

---

開発の流れとしては以下の順番に作り混んでいきます。
- ユーザー情報に飼い主かアドバイザーかを判別できるフィールドを追加する
- ユーザー登録時に、飼い主かアドバイザーかを選択して登録できるようにする
- アドバイザーの一覧画面、詳細画面を作成する
- 飼い主かアドバイザーかによって、ログイン後・サインアップ後の画面遷移先を切り替える

手順は多くかかりますが、複数のユーザー種別を扱うプロダクトはよくありますので、ぜひ身につけていきましょう

---

## ユーザーを判別できるフィールドを追加する

まずは飼い主かアドバイザーかという役割の違いをデータ上保持できるようにします。

ペットのオスメスの時のようにテキストで保持してもよいのですが、決まった選択肢の中から指定するような値は、選択肢をあらかじめ定義して利用することで扱いやすくなります。BubbleからOption setという仕組みが提供されているので、それを使ってみましょう。

---

Optionsを設定してみましょう

- 左メニューの`Data` > タブの`Option sets`と移動する
- `New Option set`に`Role`と入力して、Createボタンを押す
- 新たなOption setとしてRoleが作成されます

![bg right w:600](images/2021-11-20-06-14-02.png)

---

RoleというOption set（選択肢のセット）に、具体的なOption（選択肢）を追加していきます。今回は、`Pet Owner`と`Pet Advisor`を作成します。

- 画面右下の`New Option`に`Pet Owner`と入力して、Createボタンを押してください
- 同様に`New Option`に`Pet Advisor`と入力して、Createボタンを押してください

以上で設定完了です

![bg right w:800](images/2021-11-20-06-17-29.png)

---

次はユーザーの属性として、ロールを追加しましょう

- 左メニューの`Data` > タブの`Data types`と移動する
- `User`を選択する
- 画面右下の`Create a new field`ボタンをクリックする

![bg right w:600](images/2021-11-20-06-20-20.png)

---

- `Field name`に`Role`と入力する
  - これはわかりやすいものであれば、どういう名前でも構いません
- `Field type`に`Role`を選択する
  - ここで指定しているのは先ほど作成した`Option set`としての`Role`になります。
- Createボタンを押す

![bg right w:600](images/2021-11-20-06-23-26.png)

---

新しくフィールドを追加したので、既に作成してしまっているユーザーについてはRoleが空になってしまいます。後々、不整合を招きますので、既存データにパッチ（データ補正）をあてておきましょう。

- `App Data`タブ荷移動して、`All Users`を選択する
- 表が表示されるので、表の左端のペンアイコンをクリックして、1件ずつ編集する
  - 今作成されているユーザーはすべて飼い主のはずなので、`Role`に`Pet Owner`を指定する
![](images/2021-11-20-06-27-18.png)

---

Usersの中のすべての行がの`Role`が`Pet Owner`になっていればOK

![](images/2021-11-20-06-29-53.png)

---

## ユーザー登録時にロールを指定できるようにする

では、次はユーザー登録時に飼い主なのかアドバイザーなのか指定して登録できるようにします。

登録画面はBubbleが用意しているものを使い回してきましたが、そこに手を入れます。

---

- ログインページ`index`に移動する
- `Design`メニューの`Input forms`の中から`Dropdown`を選択して、パスワード入力欄の下に配置する
- ログイン画面は、サインアップとログインが混在していて、うまく配置できないかもしれない。`Elements treeで確認しながら追加しましょう。
- グループの中の値を選択するときは、Ctrl(MacならCmd)を押しながらダブルクリックで選択していくとよいです

![bg right w:600](images/2022-11-26-01-42-39.png)

---

- Dropdownの幅は他とそろえて見栄えを整える
- Dropdownの設定は以下のとおりとする
  - Element名：`Dropdown Role`
  - Placeholder: `Choose a role...`
  - `Choice style`：`Dynamic choices`
  - `Type of choices`: `Role`
  - `Choices source`: `All Role`
  - `Option caption`: `Current option`>`'s Display`
  - `Default value`: `Pet Owner`
  - `This input should not be empty`: チェック


※画面イメージは次のページ

---

入力後イメージ
![w:600](images/2022-11-26-01-46-54.png)

---

つづいて、入力されたRoleがユーザー登録時に設定されるようにします

- 左メニューから`Workflow` > 並んでいる正方形の中から`Button Sign up is clicked` > 並んでいるActionから`Sign the user up`の順に移動する
- Actionの設定画面内の`Change another field`ボタンをクリックする
- 入力欄がでてくるので、`Role` = `Dropdown Role` `'s value`と選択する

![bg right w:600](images/2021-11-20-06-45-29.png)

---

## プレビューと動作確認をしましょう

アドバイザーとして、アカウント登録ができた！（まだ専用画面なし）

![w:300](images/2022-11-26-01-52-18.png)
![w:500](images/![](images/2021-11-20-06-55-01.png).png)

---

## アドバイザーの一覧画面を作成する

アドバイザーの一覧画面を作りましょう

- bロゴ横のメニューを開いて、`Add a new page...`
- `Page name`に`pet_list_for_advisor`と入力する
- `Clone from`で`pet_list`を選ぶ
- 新しく画面が作成される

![bg right w:600](images/2021-11-20-06-59-31.png)

---

アドバイザーは登録されたすべてのペットを参照できるようにします。

- もとの検索条件を削除する
  - Data sourceの`Do search for`をクリックする
  - `Created By = Current User`と条件指定されている部分をゴミ箱アイコンをクリックして削除
- アドバイザーはたくさんのペットを閲覧する必要があるので、一つ一つのセルのサイズは小さくする。
  - `Min width`に150pxと`Min height`に120pxを指定
![bg right w:600](images/2022-11-26-02-13-13.png)

---

アドバイザーがログインした場合は、アドバイザー用の一覧画面に遷移するようにします

- `index`ページを開く
- 左メニューから`Workflow` > 並んでいる正方形の中から`Button Sign up is clicked` > 並んでいるActionから`Sign the user up`の順に移動する
- Actionの設定画面内の`Change another field`ボタンをクリックする
- 入力欄がでてくるので、`Role` = `Dropdown Role` `'s value`と選択する

![bg right w:600](images/2021-11-20-06-45-29.png)

---

### プレビューしましょう

何も出ない！？なんで？？

![](images/2021-11-20-07-22-55.png)

権限がないからです。

---

### Bubbleでの権限制御

今まで意識しなくてよかったですが、BubbleではDataへのアクセスが厳密に制限されています。

左メニューの`Data` > タブの`Privacy`と移動してください。
初期状態では、データは作成者しかアクセスできなくなっています。

当然と言えば当然ですね。

![bg right w:600](images/2021-11-20-07-26-09.png)

---

では、アドバイザーだったら、すべてのデータを見れるという権限を追加していきます。

- `Privacy`タブの中で、`Pets`を選択する
- `Define a new rule`ボタンをクリックする
- Rule nameに`Visible to advisor`と入力する
- Whenに`Current User` `'s Role` `is` `Pet Advisor`と選択する
  - ユーザーがアドバイザーだった場合という条件です

これでアドバイザーだったら、すべてのペットのデータが見れます。
ルールごとに参照できるフィールドを限定することもできますが、今回は利用しません。

※画面イメージは次のページ

---

![](images/2021-11-20-07-32-23.png)

では、同じように`PetWeightLogs`にもルールを追加してください。
これでアドバイザーはすべてのデータを見れるようになっているはずです。

---

## プレビューしましょう
わーい
![](images/2022-11-26-02-14-09.png)

---

次に、ログイン時の遷移先を制御します。

アドバイザーの場合は、pet_listに遷移した際に、pet_list_for_advisorに遷移するというActionを追加します

---

- indexページのWorkflowをひらく
- `Click here to add an event..`をクリックする
- `General` > `Page is loaded`を選択
- `Click here to add an action..`をクリックする
- `Navigation` > `Go to page..`をクリックする
- 設定が開くので、Destinationに`pet_list_for_advisor`を選択する
- `Only when`に`Current User` `'sRole` `is` `Pet Advisor`を選択する

![bg right w:700](images/2022-11-26-02-24-57.png)

--- 

## プレビュー＆動作確認しましょう

アドバイザーでログインしたら
![w:900](images/2022-11-26-02-27-58.png)

--- 

飼い主でログインしたら
![w:900](images/2022-11-26-02-28-44.png)

よしよし

---

#### ＜Advanced＞

## アドバイザーで勝手にアカウント作られて、
## 勝手に情報見られていいの？

---

#### ＜Advanced＞

## システム管理者が承認しないと、利用開始出来ないようにしよう

---

#### ＜Advanced＞

## 以下をやっていきます

- ユーザー情報にアドバイザーとして承認されているかを示すフィールドを追加する
- データへのアクセス権限はアドバイザーであることと同時に、承認されていることを条件に加える
- アドバイザー用のペットリストには、未承認だったら審査中ですというメッセージをだす

---
#### ＜Advanced＞

## ユーザー情報にアドバイザーとして承認されているかのフィールドを追加する

- 左メニューから`Data`>タブの`Data types`>中の`User`とクリックしていく
- 画面右下の`Create a new field`ボタンをクリックする
- Field nameに`Approved As Advisor`と入力する
- Field typeに`yes/no`を選択する
- Createボタンをクリック

![bg right w:600](images/2021-11-20-08-15-18.png)

---

#### ＜Advanced＞

追加されたフィールドに`default`という欄があるので、`no`（もしくは`いいえ`）を設定しておく。
作成されたタイミングでは、未承認状態となる。
 
 ![](images/2021-11-20-08-18-00.png)

---

#### ＜Advanced＞

既存のユーザーについては、`Approved As Advisor`はすべて`no`にしておく
(めんどうで、しょんぼり。。。だけど、大事！)

![](images/2021-11-20-08-21-51.png)

---

#### ＜Advanced＞

## データへのアクセス権限は承認されているかも見る

- 左メニューから`Data`>タブの`Privacy`>中の`Pets`とクリックしていく
- `Visible to advisor`のWhenの条件が記載されている部分の末尾の`Pet Advisor`をクリックする
- `More`があらわれるので`More`をクリックする
- `and` `Current User` `'s Approved As Advisor` `is "yes"`と選択する
- `PetWeightLogs`も同様にする

---

#### ＜Advanced＞

動作確認してみよう
`Approved As Advisor`が`no`のユーザーでログインしてみる

![](images/2022-11-26-02-36-18.png)

よし

---

#### ＜Advanced＞

`Approved As Advisor`が`yes`にしたら？

![](images/2022-11-26-02-35-51.png)

よし

---

#### ＜Advanced＞

## 未承認だったら審査中ですというメッセージをだす

- pet_list_for_advisorの画面で`Design`メニューを開く
- `Popup`を追加する
- `Popup`の上にテキストElementを追加して、審査中である旨のメッセージを記載する
![bg right w:700](images/2021-11-20-08-33-33.png)

---

#### ＜Advanced＞

- メニューからWorkflowに移動する
- `Click here to add an event..`>`Page is loaded`とクリックする
- `Click here to add an action..`>`Element Actions`>`Show`とクリックする
- Elementに`Popup A`を指定する
- Only whenに、`Current User` `'s Approved As Advisor` `is "no"`を指定する

![bg right w:600](images/2021-11-20-08-38-07.png)

---

#### ＜Advanced＞

## 動作確認してみよう

yesのアドバイザーなら
![](images/2022-11-26-02-35-51.png)

よし

---

#### ＜Advanced＞

noなら
![](images/2022-11-26-02-39-20.png)

よし

---

#### ＜Advanced＞

## システム管理者はどうやって気づくの？

---

#### ＜Advanced＞

## アドバイザーの登録がされたら、システム管理者にメール通知されるようにしょう

---

#### ＜Advanced＞

## システム管理者にメール通知されるようにしょう

- `index`ページを開く
- メニューからWorkflowに移動して、`Button Sign up is clicked`を選ぶ
- `Click here to ad an action...`> `Email`>`Send Email`とクリックする
- Actionの位置を`Go to page pet_list`の前にドラッグして移動する

![bg right w:600](images/2022-11-26-02-41-30.png)

---

#### ＜Advanced＞

- Toに自分のメールアドレスを設定する
- Sender nameは`PetLog`
- Subjectは `New Advisor Registered`
- Bodyは以下の本文の末尾に`dynamic data isert`で`Input Email(sign up)` `'s value`を選択
```
New Advisor has been Registered.
Please check it.

Email: 
```

![bg right w:400](images/2022-11-26-02-43-23.png)

---

#### ＜Advanced＞

- Only Whenに`Dropdown Role` `'s value` `is` `Pet Advisor`を選択

![bg right w:500](images/2021-11-20-11-26-00.png)

---

#### ＜Advanced＞

## 動作確認してみよう
アドバイザーでサインアップしたら
![w:600](images/2021-11-20-08-50-37.png)
きたきた

---

#### ＜Advanced＞

飼い主なら

うん、こない。やったー


---

#### ＜Advanced＞

## 演習

アドバイザーから飼い主、もしくは飼い主からアドバイザーにアプローチできる機能をつくって見よう

- 例：飼い主にアドバイスを送れる
- 例：広告を掲載できる
- 例：アドバイザーに相談を投げられる　などなど

---

### 今日のおさらい

---

### デザインを作り込みました

- ディスプレイサイズに合わせた画面をつくりました
  - レスポンシブウェブデザインという手法を使って、以下のようなルールを用いて、ディスプレイサイズに合わ見た目を制御しました.
    - 親要素内の配置ルール
    - 要素のサイズ決定ルール
    - 表示の有無ルール
- Styleを使ってみました
  - Styleを編集・追加したり、個別にスタイルをあてました

---

## ロジックを作りこみました

- 画面操作に対するフィードバックを返しました
- データを抽出、加工しました
- 画面を権限によって切り替えました

Bubbleで様々なところにロジックを埋め込めるのを一緒に見ていきました

---

## 最後に

以上で、Bubbleの基礎講義は終わりになります。
このあとはBubbleの応用編になります。

触れられなかった機能もたくさんありますが、
Bubbleはマニュアルとリファレンスが充実していますので、
もしBubbleを採用するならぜひ活用してください。

マニュアルはこちらです。
https://manual.bubble.io/

リファレンスは画面上でわからないものにカーソルを合わせると現れます。
だいたいの機能についてリファレンスへのリンクが浮き出てきます。

---

## お疲れ様でした
